# Perception configuration

perception:
  pipeline:
    disable_keypoint_extraction: false  # Skip keypoints for faster preview
    disable_skeletonization: false  # Skip skeleton/path extraction

  segmentation:
    method: "color_threshold"  # Options: "color_threshold", "edge_detection", "combined", "adaptive"
    
    # Color thresholding parameters
    color_range:
      # HSV range for white rope
      hsv_lower: [0, 0, 80]
      hsv_upper: [180, 160, 255]


      # HSV color range for black rope (H: 0-180, S: 0-255, V: 0-255)
      # hsv_lower: [0, 0, 0]  # Lower bound in HSV
      # hsv_upper: [180, 50, 80]  # Upper bound in HSV (low saturation, low brightness for black)
      # Legacy BGR bounds (kept for compatibility)
      lower: [200, 200, 200]  # BGR lower bound
      upper: [255, 255, 255]  # BGR upper bound
    
    # Preprocessing
    blur_kernel_size: 5  # Gaussian blur kernel size (must be odd)
    pre_box_filter:
      enabled: true
      kernel_size: 3
    
    # Morphological operations
    morph_operations:
      opening_kernel_size: 1  # Removes noise (erosion then dilation)
      closing_kernel_size: 7  # Fills gaps (dilation then erosion)
    
    # Edge detection parameters
    edge_detection:
      canny_low_threshold: 50  # Lower threshold for Canny edge detection
      canny_high_threshold: 150  # Upper threshold for Canny edge detection
    
    # Contour filtering parameters
    contour_filter:
      min_area: 80  # Minimum contour area in pixels (filters noise)
      max_area: null  # Maximum contour area (null for no limit)
      min_aspect_ratio: 1.2  # Minimum aspect ratio (length/width) for rope-like shapes
      hole_fill_max_area: null  # Fill small holes; larger loop interiors are preserved
      hollow_fill_ratio_threshold: 0.35  # Skip aspect ratio for hollow (loop-like) contours

    cleanup:
      min_area: 300  # pixels; remove small blobs before skeletonization
      keep_largest: true  # keep the largest connected component

  keypoint_detection:
    endpoint_detection:
      method: "combined" # "contour_analysis", "skeleton_endpoints", or "combined"
      min_confidence: 0.4
      merge_distance: 8
    crossing_detection:
      method: "skeleton_intersection"
      min_confidence: 0.5
      min_area: 6
      min_neighbor_count: 3
      min_branch_length: 6
      min_branch_count: 3
    skeletonization:
      method: "zhang_suen"
      prune_length: 4
      close_loop_max_gap: 0
      pre_close_kernel_size: 5
      pre_dilate_kernel_size: 3
      pre_dilate_iterations: 1

  keypoint_mask:
    endpoint_radius: 6  # pixels
    crossing_radius: 8  # pixels

  skeletonization:
    method: "zhang_suen"  # or "lee", "medial_axis"
    prune_length: 4  # pixels
    close_loop_max_gap: 0  # pixels; close tiny gaps to recover loops
    pre_close_kernel_size: 5  # pixels, 0 disables
    pre_dilate_kernel_size: 3  # pixels, 0 disables
    pre_dilate_iterations: 1
