---
alwaysApply: true
---

# ============================================================
# Project: Rope Tying Robot (Current State)
# ============================================================
# This repository currently focuses on a rope perception pipeline
# built with OpenCV and Python, plus supporting utilities, configs,
# examples, and tests.
#
# Implemented today:
# - Perception pipeline (segmentation, keypoints, skeletonization,
#   path/graph extraction, state estimation, visualization, live video)
# - Camera interface (basic capture; calibration loader is TODO)
# - Utilities (config loader, geometry, logging)
#
# Not yet implemented (planned):
# - Control, learning, and simulation modules
# - Robot arm interface
# ============================================================


# ============================================================
# GENERAL CODING RULES
# ============================================================

# Language
- All code MUST be written in Python unless explicitly stated otherwise.
- Assume Python >= 3.10.

# Naming
- Variables and functions MUST use snake_case.
- Classes MUST use PascalCase.
- Constants MUST be uppercase with underscores.
- File names MUST use snake_case.

# Style
- Follow PEP8 strictly.
- Max line length: 88 characters.
- Prefer explicit over implicit behavior.
- Avoid magic numbers; define named constants.

# Typing
- Use type hints for function arguments and return values.
- Use `typing` for complex types.

# Documentation
- Every module MUST have a top-level docstring.
- Every public function/class MUST have a docstring describing:
  - Purpose
  - Inputs
  - Outputs
  - Assumptions or constraints


# ============================================================
# PROJECT ARCHITECTURE (CURRENT)
# ============================================================

# Current directories:
# src/
# - perception/        # segmentation, keypoints, skeletonization, state, video
# - hardware/          # camera.py only (calibration load is TODO)
# - utils/             # config loader, geometry, logging
# - configs/           # YAML configs (perception used by code)
# examples/            # live demo + sample images
# tests/               # perception + utils tests

# Separation of concerns is mandatory.
- Perception logic MUST NOT be mixed with future control or learning logic.
- Image processing code MUST NOT command hardware actions.


# ============================================================
# PERCEPTION (OpenCV) RULES (CURRENT)
# ============================================================

- Perception outputs MUST use well-defined data structures
  (dataclasses preferred) with explicit coordinate conventions.
- Image processing functions MUST:
  - Accept numpy arrays as input
  - Never read from disk internally
  - Never display images unless explicitly requested

- Skeletonization returns both:
  - A main path (longest path) AND
  - A graph representation with edges for loops and branches
  Prefer edges when visualizing looped ropes.

- Segmentation supports cleanup of small connected components
  via config. Use it to suppress residual blobs that cause
  heavy skeleton graphs.


# ============================================================
# CONFIGURATION RULES (CURRENT)
# ============================================================

- All tunable parameters MUST live in config files.
- Use YAML for configs.
- No hardcoded paths.
- Configs MUST include clear comments and units for numeric values.

- The perception config currently includes:
  - Segmentation parameters (HSV, morphology, contour filtering)
  - Cleanup parameters (component filtering)
  - Pipeline toggles (disable keypoints/skeletonization)


# ============================================================
# TESTING RULES (CURRENT)
# ============================================================

- Unit tests exist for perception and utils.
- Tests MUST be deterministic and use pytest style.
- When adding new modules (control, learning, simulation),
  add unit tests alongside them.


# ============================================================
# FUTURE MODULES (NOT YET IMPLEMENTED)
# ============================================================

# Control (planned)
- If/when added, all motion commands MUST have bounds checking
  and support emergency stop integration.

# Learning (planned)
- If/when added, training MUST be reproducible and logged.

# Simulation (planned)
- If/when added, simulation MUST mirror real hardware interfaces.


# ============================================================
# ERROR HANDLING & LOGGING
# ============================================================

- NEVER silently fail.
- Use explicit exceptions with meaningful messages.
- Use the `logging` module (not print).


# ============================================================
# CURSOR-SPECIFIC BEHAVIOR
# ============================================================

When generating or modifying code:
- Prefer small, composable functions.
- Avoid speculative features not requested.
- Do NOT change unrelated files.
- Explain assumptions briefly in comments when needed.

When unsure:
- Ask clarifying questions before implementing major changes.
- Default to correctness and clarity over speed.

# ============================================================
# END OF RULES
# ============================================================
